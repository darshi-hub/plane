<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>2D Open World Driving</title>
  <style>
    body { margin:0; background:#222; }
    canvas { display:block; margin:0 auto; background:#444; }
  </style>
</head>
<body>
<canvas id="game" width="800" height="600"></canvas>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// --- Map setup ---
const TILE = 64;
const MAP_W = 50, MAP_H = 50;
const map = [];
for (let y=0; y<MAP_H; y++) {
  map[y] = [];
  for (let x=0; x<MAP_W; x++) {
    if (x%5===0 || y%5===0) map[y][x] = "road";
    else if (Math.random()<0.1) map[y][x] = "building";
    else map[y][x] = "grass";
  }
}

// --- Car setup ---
let car = { x: TILE*2, y: TILE*2, angle: 0, speed: 0 };
const keys = {};
window.addEventListener("keydown", e=>keys[e.code]=true);
window.addEventListener("keyup", e=>keys[e.code]=false);

// --- Update ---
function update(dt) {
  if (keys["ArrowUp"]||keys["KeyW"]) car.speed += 0.2;
  if (keys["ArrowDown"]||keys["KeyS"]) car.speed -= 0.2;
  if (keys["ArrowLeft"]||keys["KeyA"]) car.angle -= 0.05*car.speed;
  if (keys["ArrowRight"]||keys["KeyD"]) car.angle += 0.05*car.speed;

  car.speed *= 0.95; // friction
  const nx = car.x + Math.sin(car.angle)*car.speed;
  const ny = car.y - Math.cos(car.angle)*car.speed;

  // Collision with buildings
  const tx = Math.floor(nx/TILE), ty = Math.floor(ny/TILE);
  if (map[ty] && map[ty][tx] !== "building") {
    car.x = nx; car.y = ny;
  }
}

// --- Draw ---
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Camera center
  const camX = car.x - canvas.width/2;
  const camY = car.y - canvas.height/2;

  // Draw map
  for (let y=0; y<MAP_H; y++) {
    for (let x=0; x<MAP_W; x++) {
      const tile = map[y][x];
      let color = "#3a3"; // grass
      if (tile==="road") color="#666";
      if (tile==="building") color="#555";
      ctx.fillStyle = color;
      ctx.fillRect(x*TILE-camX, y*TILE-camY, TILE, TILE);
      if (tile==="building") {
        ctx.fillStyle="#999";
        ctx.fillRect(x*TILE-camX+10, y*TILE-camY+10, TILE-20, TILE-20);
      }
    }
  }

  // Draw car
  ctx.save();
  ctx.translate(car.x-camX, car.y-camY);
  ctx.rotate(car.angle);
  ctx.fillStyle="red";
  ctx.fillRect(-15,-30,30,60);
  ctx.restore();

  // HUD
  ctx.fillStyle="white";
  ctx.fillText("Speed: "+car.speed.toFixed(1),10,20);
  ctx.fillText("Pos: "+Math.floor(car.x)+","+Math.floor(car.y),10,40);
}

// --- Loop ---
let last=performance.now();
function loop(now){
  const dt=(now-last)/16; last=now;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}
loop(last);
</script>
</body>
</html>
